<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>文件上传</title>
  <!-- 引入样式 -->
  <link rel="stylesheet" href="../../plugins/element-ui/index.css" />
  <link rel="stylesheet" href="../../styles/common.css" />
  <link rel="stylesheet" href="../../styles/page.css" />
</head>
<body>
   <div class="addBrand-container" id="food-add-app">

    <div class="container">
        <!--
            el-upload：文件上传组件
                属性：
                    class：设置文件上传框的样式
                    action：文件上传的提交地址
                    show-file-list：是否展示上传的文件列表
                    on-success：文件上传成功之后绑定的处理函数
                    before-upload：文件上传之前绑定的处理函数
                    ref：设置文件上传的一些校验规则
               重要属性：
                  action：文件上传的提交地址
                  name：设置文件上传输入框的name属性值 如果不设置，默认为file
                  on-success：文件上传成功之后绑定的处理函数   实现文件上传成功之后 下载图片
                  before-upload：文件上传之前绑定的处理函数  【校验上传文件的格式和大小】
        -->
        <el-upload class="avatar-uploader"
                action="/common/upload"
                :show-file-list="true"
                :on-success="handleAvatarSuccess"
                :before-upload="beforeUpload"
                ref="upload">
            <!--imageUrl：表示图片地址  如果地址为空 则不展示 不为空 进行展示-->
            <img v-if="imageUrl" :src="imageUrl" class="avatar"></img>
            <i v-else class="el-icon-plus avatar-uploader-icon"></i>
        </el-upload>
    </div>

  </div>
    <!-- 开发环境版本，包含了有帮助的命令行警告 -->
    <script src="../../plugins/vue/vue.js"></script>
    <!-- 引入组件库 -->
    <script src="../../plugins/element-ui/index.js"></script>
    <!-- 引入axios -->
    <script src="../../plugins/axios/axios.min.js"></script>
    <script src="../../js/index.js"></script>
    <script>
      new Vue({
        el: '#food-add-app',
        data() {
          return {
            imageUrl: ''
          }
        },
        methods: {
            //图片上传成功之后绑定的函数：图片一旦上传成功了，就从响应数据中获取上传的文件名称 下载到本地显示预览
          handleAvatarSuccess (response, file, fileList) {
              //response：文件上传成功之后的响应数据
              //设置图片地址：下载功能
              this.imageUrl = `/common/download?name=${response.data}`
          },
          //图片上传之前绑定的处理函数
          beforeUpload (file) {
            if(file){
              const suffix = file.name.split('.')[1]
              const size = file.size / 1024 / 1024 < 2
              if(['png','jpeg','jpg'].indexOf(suffix) < 0){
                this.$message.error('上传图片只支持 png、jpeg、jpg 格式！')
                this.$refs.upload.clearFiles()
                return false
              }
              if(!size){
                this.$message.error('上传文件大小不能超过 2MB!')
                return false
              }
              return file
            }
          }
        }
      })
    </script>
</body>
</html>